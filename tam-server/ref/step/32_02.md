# 32_02 - 클라이언트로부터 메시지를 수신하고 응답하기

## 학습 목표

- 클라이언트의 연결을 기다리고 데이터 통신을 진행할 수 있다.

## 실습 소스 및 결과

- src/main/java/kyh/tam/ServerApp.java 변경

## 실습

### 실습 1 : 클라이언트의 연결을 기다린다.

- ServerApp.java 변경
  - 클라이언트의 연결을 처리할 ServerSocket을 생성한다.
  - ServerSockect의 accept() 메서드를 사용해 클라이언트의 연결이 있을 때 해당 클라이언트와의 스트림을 가진 소켓을 반환한다.

### 실습 2 : 클라이언트가 보낸 메시지를 읽고 응답 메시지를 전송한다.

- ServerApp.java 변경
  - 소켓으로부터 데이터 입출력에 필요한 스트림을 얻는다.
  - 간단한 프로토콜을 정의하여 서버와 통신한다.

#### 추가사항

- BufferedReader / BufferedWriter 를 클라이언트와 서버간 데이터 통신을 위해 사용할 때 주의할점
  - BufferedReader는 readLine() 메서드를 이용해 데이터를 읽는다.
  - BufferedWriter는 write() 메서드를 이용해 데이터를  출력한다.
  - readLine() 메서드는 데이터를 개행 문자로 구분한다.
  - 하지만 write() 메서드는 데이터의 끝에 개행 문자를 붙여주지 않는다.
  - 따라서 본 실습에서 데이터를 write 할 때 추가적으로 개행문자를 붙이는데, 플랫폼마다 개행문자가 다르다.
    - 자바에서는 System.lineSeparator() 를 통해 개행문자를 얻어올 수 있다.

#### 추가사항

- out.flush()를 해야하는 이유
  - flush()는 현재 버퍼에 있는 내용을 전송하고 버퍼를 비운다.
  - XXXln(), 예를 들어 println() 메서드로 데이터를 전송하는 경우 개행문자를 기준으로 내용이 전달되지만 일반적인 write()는 버퍼가 가득찰때까지 해당 내용을 전송하지 않는다.
  - 따라서 flush()를 사용하여 버퍼를 비우며 내용을 전달하는 것이다.
  - close() 메서드가 호출되면 flush()가 자동으로 호출된다.